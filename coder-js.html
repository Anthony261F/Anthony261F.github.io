<html>
    <head>
        <title>Encoder / décoder en JavaScript</title>
    </head>
    <body>
        <div style="text-align: center;">
            <h1>Encoder / décoder en JavaScript</h1>
            <hr>
            <h3>Générer une clé de cryptage</h3>
            <br>
            <h6>Entrer la longueur de la clé souhaitée (4 - 100)</h6>
            <input type="number" id="longueur-clee" required minlength="4" maxlength="100" size="10">
            <br><br>
            <button onclick="generateEncryptionKey()">Générer</button>
            <br>
            <h6>Clé :</h6>
            <span id="resultclee">...</span>

            <script>
                // Génère une clé de cryptage aléatoire
                function generateEncryptionKey() {
                    var key = '';
                    var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                    var length = document.getElementById("longueur-clee").value;

                    for (var i = 0; i < length; i++) {
                        key += characters.charAt(Math.floor(Math.random() * characters.length));
                    }
                    document.getElementById("resultclee").innerText = key;
                }
            </script>

            <br><hr><br>
            <h3>Encoder  un texte</h3>
            <br>
            <h6>Entrer la clé de cryptage</h6>
            <input type="password" id="clee1" required minlength="4" maxlength="100" size="100">
            <input type="checkbox" onclick="togglePasswordVisibility()" id="toggle-clee1">
            <br>
            <h6>Texte à traiter</h6>
            <input type="text" id="text1" size="50">
            <br><br>
            <button onclick="encryptText()">Encoder</button>
            
            <br>
            <h6>Résultat :</h6>
            <span id="code1">...</span>
            <br><HR>
            <br><br><br>
            <h3>Décoder  un texte</h3>
            <br>
            <h6>Entrer la clé de cryptage</h6>
            <input type="password" id="clee2" required minlength="4" maxlength="100" size="100">
            <input type="checkbox" onclick="togglePasswordVisibility2()" id="toggle-clee2">
            <br>
            <h6>Texte à traiter</h6>
            <input type="text" id="text2" size="50">
            <br><br>
            
            <button onclick="decryptText()">Décoder</button>
            <br>
            <h6>Résultat :</h6>
            <span id="code2">...</span>

            <script>
              function togglePasswordVisibility() {
                var passwordInput = document.getElementById("clee1");
                var toggleCheckbox = document.getElementById("toggle-clee1");

                if (toggleCheckbox.checked) {
                  passwordInput.type = "text";
                } else {
                  passwordInput.type = "password";
                }
              }

              function togglePasswordVisibility2() {
                var passwordInput = document.getElementById("clee2");
                var toggleCheckbox = document.getElementById("toggle-clee2");

                if (toggleCheckbox.checked) {
                  passwordInput.type = "text";
                } else {
                  passwordInput.type = "password";
                }
              }

              function encryptText() {
                var textInput = document.getElementById("text1");
                var encryptionKeyInput = document.getElementById("clee1");
                var encryptedText = '';

                var text = textInput.value;
                var encryptionKey = encryptionKeyInput.value;
                var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789²&é(-è_çà)=^$*€ù,;:!<<?./§%¨£µ+°#{[|`\^@]}';

                for (var i = 0; i < text.length; i++) {
                  var char = text.charAt(i);

                  if (characters.indexOf(char) !== -1) {
                    var charIndex = characters.indexOf(char);
                    var keyIndex = i % encryptionKey.length;
                    var keyChar = encryptionKey.charAt(keyIndex);
                    var encryptedIndex = (charIndex + characters.indexOf(keyChar)) % characters.length;
                    encryptedText += characters.charAt(encryptedIndex);
                  } else {
                    encryptedText += char; // Conserve les caractères spéciaux tels quels
                  }
                }

                document.getElementById("code1").innerText = encryptedText;
              }

              function decryptText() {
                var encryptedTextInput = document.getElementById("text2");
                var encryptionKeyInput = document.getElementById("clee2");
                var decryptedText = '';

                var encryptedText = encryptedTextInput.value;
                var encryptionKey = encryptionKeyInput.value;
                var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789²&é(-è_çà)=^$*€ù,;:!<<?./§%¨£µ+°#{[|`\^@]}';

                for (var i = 0; i < encryptedText.length; i++) {
                  var char = encryptedText.charAt(i);

                  if (characters.indexOf(char) !== -1) {
                    var charIndex = characters.indexOf(char);
                    var keyIndex = i % encryptionKey.length;
                    var keyChar = encryptionKey.charAt(keyIndex);
                    var decryptedIndex = (charIndex - characters.indexOf(keyChar) + characters.length) % characters.length;
                    decryptedText += characters.charAt(decryptedIndex);
                  } else {
                    decryptedText += char; // Conserve les caractères spéciaux tels quels
                  }
                }

                document.getElementById("code2").innerText = decryptedText;
              }
            </script>
        </div>
    </body>
</html>
